[33mcommit f0bd8a28505ac79fa38d542b8eaab9fa34c96df0[m[33m ([m[1;36mHEAD -> [m[1;32mmaster[m[33m)[m
Author: Deploy User <deploy@ip-172-31-23-90.us-east-2.compute.internal>
Date:   Wed Apr 6 00:01:30 2022 +0000

    Mailer on demand

[1mdiff --git a/app/controllers/api/v1/documents_controller.rb b/app/controllers/api/v1/documents_controller.rb[m
[1mindex ee04ef55..47504df0 100644[m
[1m--- a/app/controllers/api/v1/documents_controller.rb[m
[1m+++ b/app/controllers/api/v1/documents_controller.rb[m
[36m@@ -2,7 +2,7 @@[m [mclass Api::V1::DocumentsController < ApplicationController[m
   protect_from_forgery with: :null_session[m
   include ApplicationHelper[m
   before_action :document_exists!, only: [:get_document][m
[31m-  before_action :already_logged_in[m
[32m+[m[32m  before_action :already_logged_in_helper[m
   before_action :doorkeeper_authorize!, only: [:get_document, :get_documents][m
   skip_before_action :doorkeeper_authorize!, unless: :has_access_token?[m
   [m
[36m@@ -25,11 +25,15 @@[m [mclass Api::V1::DocumentsController < ApplicationController[m
     user_document_download_tracker = get_user_document_download_tracker(user_id_str)[m
     can_access_document = can_access_documents(user_document_download_tracker, current_user_type_api(user))[m
     [m
[31m-    if can_access_document and @document.original_file.attached?  and already_logged_in [m
[32m+[m[32m    if already_logged_in_helper and can_access_document and @document.original_file.attached?[m[41m [m
      json_document = json_document.merge(file: url_for(@document.original_file))[m
[32m+[m[32m     puts already_logged_in_helper[m
     else[m
[32m+[m[32m      if current_user.confirmed_at? == false[m
[32m+[m[32m       current_user.send_confirmation_instructions[m
[32m+[m[32m      end[m[41m [m
      json_document = json_document.merge(file: "")[m
[31m-     [m
[32m+[m[32m     puts already_logged_in_helper[m
     end[m
     #to here[m
 [m
[36m@@ -201,41 +205,4 @@[m [mprotected[m
     return params[:access_token][m
   end[m
 [m
[31m-def already_logged_in[m
[31m-  Warden::Manager.after_set_user except: :fetch do |record, warden, options|[m
[31m-    if record.devise_modules.include?(:session_limitable) &&[m
[31m-       warden.authenticated?(options[:scope]) &&[m
[31m-       !record.skip_session_limitable?[m
[31m-  [m
[31m-       if !options[:skip_session_limitable][m
[31m-        unique_session_id = Devise.friendly_token[m
[31m-        warden.session(options[:scope])['unique_session_id'] = unique_session_id[m
[31m-        record.update_unique_session_id!(unique_session_id)[m
[31m-       else[m
[31m-        warden.session(options[:scope])['devise.skip_session_limitable'] = true[m
[31m-       end[m
[31m-    end[m
[31m-  end[m
[31m-  [m
[31m-  Warden::Manager.after_set_user only: :fetch do |record, warden, options|[m
[31m-    scope = options[:scope][m
[31m-    if record.devise_modules.include?(:session_limitable) &&[m
[31m-      warden.authenticated?(scope) &&[m
[31m-      options[:store] != false[m
[31m-     if record.unique_session_id != warden.session(scope)['unique_session_id'] &&[m
[31m-        !record.skip_session_limitable? && [m
[31m-        !warden.session(scope)['devise.skip_session_limitable'][m
[31m-       Rails.logger.warn do[m
[31m-         '[devise-security][session_limitable] session id mismatch: '\[m
[31m-         "expected=#{record.unique_session_id.inspect} "\[m
[31m-         "actual=#{warden.session(scope)['unique_session_id'].inspect}"[m
[31m-       end[m
[31m-       warden.raw_session.clear[m
[31m-       warden.logout(scope)[m
[31m-       throw :warden, scope: scope, message: :session_limited[m
[31m-     end[m
[31m-    end[m
[31m-  end[m
[31m-end[m
[31m-[m
 end[m
[1mdiff --git a/app/controllers/application_controller.rb b/app/controllers/application_controller.rb[m
[1mindex 2f5d5df0..2a5c9131 100644[m
[1m--- a/app/controllers/application_controller.rb[m
[1m+++ b/app/controllers/application_controller.rb[m
[36m@@ -1,7 +1,7 @@[m
 class ApplicationController < ActionController::Base[m
   include Devise::Controllers::Rememberable[m
   require 'csv'[m
[31m-  before_action :already_logged_in[m
[32m+[m[32m  #before_action :already_logged_in[m
   protect_from_forgery with: :null_session[m
   before_action :configure_devise_permitted_parameters, if: :devise_controller?[m
   before_action :miniprofiler[m
[36m@@ -327,5 +327,8 @@[m [mprotected[m
     end[m
   end[m
 [m
[32m+[m[32m  def send_confirmation_email[m
[32m+[m[32m    current_user.send_confirmation_instructions[m
[32m+[m[32m  end[m
 [m
 end[m
[1mdiff --git a/app/controllers/users/confirmations_controller.rb b/app/controllers/users/confirmations_controller.rb[m
[1mindex 8b048fb9..c0693f91 100644[m
[1m--- a/app/controllers/users/confirmations_controller.rb[m
[1m+++ b/app/controllers/users/confirmations_controller.rb[m
[36m@@ -12,7 +12,9 @@[m [mclass Users::ConfirmationsController < Devise::ConfirmationsController[m
     super[m
     if @email[m
       @first_name = User.find_by_email(@email).first_name[m
[32m+[m[32m      redirect_to "http://valid.todolegal.app"[m
     end[m
[32m+[m[41m    [m
   end[m
 [m
   # GET /resource/confirmation?confirmation_token=abcdef[m
[1mdiff --git a/app/helpers/application_helper.rb b/app/helpers/application_helper.rb[m
[1mindex ff993c76..f096df74 100644[m
[1m--- a/app/helpers/application_helper.rb[m
[1m+++ b/app/helpers/application_helper.rb[m
[36m@@ -70,11 +70,12 @@[m [mmodule ApplicationHelper[m
 [m
   #deprecated[m
   def can_access_documents(user_document_download_tracker, current_user_type)[m
[31m-   if current_user_type == "pro"[m
[32m+[m[32m   if current_user_type == "pro"[m[41m [m
      return true[m
    elsif current_user_type == "basic"[m
      return user_document_download_tracker.downloads < MAXIMUM_BASIC_MONTHLY_DOCUMENTS[m
    else[m
[32m+[m[32m      already_logged_in_helper[m[41m [m
     #  return user_document_download_tracker.downloads < MAXIMUM_NOT_LOGGGED_MONTHLY_DOCUMENTS[m
     return false[m
    end[m
[36m@@ -165,7 +166,8 @@[m [mmodule ApplicationHelper[m
     end[m
   end[m
 [m
[31m-  def already_logged_in[m
[32m+[m[32m  def already_logged_in_helper[m
[32m+[m[32m    puts "dosinsdofinsdoifn  Entre al if ajjdnfoinwponwponwepgewngpwegon"[m
     Warden::Manager.after_set_user only: :fetch do |record, warden, options|[m
       scope = options[:scope][m
       if record.devise_modules.include?(:session_limitable) &&[m
[36m@@ -185,14 +187,15 @@[m [mmodule ApplicationHelper[m
          warden.logout(scope)[m
          throw :warden, scope: scope, message: :session_limited[m
          sign_out current_user[m
[32m+[m[32m         puts "owefnweofnweofinwf oewfnweofnw Estoy logueado sjneofsnfoeiwfnweoifnweoifn"[m
          return true[m
[32m+[m[41m         [m
        end[m
       end[m
     end[m
[32m+[m[32m    puts "owefnweofnweofinwf oewfnweofnw Estoy deslogueado sjneofsnfoeiwfnweoifnweoifn"[m
     return false[m
   end[m
   [m
 [m
[31m-[m
[31m-[m
 end[m
[1mdiff --git a/app/views/home/index.html.erb b/app/views/home/index.html.erb[m
[1mindex 1039f5d1..7246d6a4 100644[m
[1m--- a/app/views/home/index.html.erb[m
[1m+++ b/app/views/home/index.html.erb[m
[36m@@ -14,7 +14,7 @@[m
   <div class="container container--home">[m
     [m
     <br/>[m
[31m-[m
[32m+[m[41m    [m
     <div class="row">[m
       <div class="col-sm-6 col-md-4 py-2">[m
         <div class="card card-body h-100 card-with-border landing-cards" style="padding:0px">[m
[36m@@ -50,6 +50,6 @@[m
         </div>[m
       </div>[m
     </div>[m
[31m-[m
[32m+[m[41m  [m
   </div>[m
 </div>[m
\ No newline at end of file[m
